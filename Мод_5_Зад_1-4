--«адание 1. —делайте запрос к таблице payment. ѕронумеруйте все продажи от 1 до N по дате

select payment_id,
		payment_date,
		row_number () over (order by payment_date)
from payment;

/*«адание 2. »спользу€ оконную функцию, добавьте колонку с пор€дковым номером продажи дл€ каждого покупател€, сортировка платежей должна быть по дате*/

select payment_id,
		payment_date,
		customer_id,
		row_number () over (partition by customer_id order by payment_date)
from payment;

/*«адание 3. ƒл€ каждого пользовател€ посчитайте нарастающим итогом сумму всех его платежей, сортировка должна быть по дате платежа*/

select last_name||' '||first_name as customer_name,
		payment_id,
		payment_date,
		amount,
		sum(amount) over (partition by customer_id order by payment_date)
from customer 
	join payment using (customer_id);

--«адание 4. ƒл€ каждого покупател€ выведите данные о его последней оплате аренды

with cte1 as
	(select customer_id,max(payment_date) as mpd
	from payment p
	group by 1)
select p2.customer_id,p2.payment_id,p2.payment_date,amount
from payment p2
	join cte1 using (customer_id)
where payment_date=mpd and amount>0
order by 1;
/*без выражени€ amount>0 результат 623, т.к у некоторых покупателей есть платежи с одинаковой датой и сумма платежа одного или нескольких из них равна нулю*/